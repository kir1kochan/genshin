#include "AttackSkill.h"
#include "AttackSkill.h"
#include "cocos2d.h"
#include "../../Player.h"

AttackSkill::AttackSkill(int id, const std::string& name, float cooldown, float staminaCost, float attackPower, float range, Element element)
    : Skill(id, name, cooldown, staminaCost), attackPower(attackPower), range(range), element(element) {}

 

// 获取攻击力
float AttackSkill::getAttackPower() const {
    return attackPower;
}

// 获取范围
float AttackSkill::getRange() const {
    return range;
}

// 激活技能
void AttackSkill::activate(Player* user, Enemy& target) {
    // 检查目标是否在范围内
    float distance = user->getPosition().distance(target.getPosition());
    if (distance > range) {
        CCLOG("AttackSkill: Target out of range for %s.", name.c_str());
        return;
    }
    // 播放技能动画（根据技能 id 选择对应的动画）
    playSkillAnimation(user, target);
    // 对目标造成伤害
    user->attackTargetBySkill(target, attackPower,element);
    CCLOG("%s dealt %.2f damage to target.", name.c_str(), attackPower);
}
// 播放技能动画
void AttackSkill::playSkillAnimation(Player* user, Enemy& target) {
    

    // 根据技能 id 选择不同的动画效果
    switch (id) {
    case 900101:  // Fireball
      
        break;
    case 900102:  // Water Blast
    
        break;
    case 900103:  // Thunderstrike
     
        break;
    case 900104:  // Earthquak
        break;
    default:
        CCLOG("Unknown skill id: %d", id);
        break;
    }
}

void AttackSkill::loadFromJson(const std::string& jsonString) {
    Skill::loadFromJson(jsonString);  // 加载基类的属性

    rapidjson::Document doc;
    doc.Parse(jsonString.c_str());

    if (doc.HasParseError() || !doc.IsObject()) {
        CCLOG("Error parsing JSON for AttackSkill");
        return;
    }

    // 解析 AttackSkill 特有的属性
    if (doc.HasMember("attackPower") && doc["attackPower"].IsFloat()) {
        attackPower = doc["attackPower"].GetFloat();
    }

    if (doc.HasMember("range") && doc["range"].IsFloat()) {
        range = doc["range"].GetFloat();
    }

    if (doc.HasMember("element") && doc["element"].IsInt()) {
        element = static_cast<Element>(doc["element"].GetInt());  // 假设 Element 是一个枚举
    }
}
